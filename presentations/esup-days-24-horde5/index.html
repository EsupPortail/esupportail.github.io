<!doctype html>
<html lang="fr">

<!-- version 1.0 -->

  <head>
    <meta charset="utf-8">

    <title>Retour sur l'usage de Horde 5 à l'Université Paris 1</title>

    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Oswald:300,400,700" rel="stylesheet"> 

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/simple.css" id="theme"> 
    <link rel="stylesheet" href="css/esup-theme.css">

    <link rel="stylesheet" href="plugin/highlight/default.min.css">


  </head>

  <body>
    <!-- Add/remove 'lighter' class here to change the look of the whole template (lighter = newer version) -->
    <div class="reveal esup lighter">

      <div class="slides">

        <section class="main-title">
          <header>
            <h1>
              <img src="./img/logo-esup--NEW.png" alt="ESUP-Portail" class="header-img upleft">
              <img src="./img/event-datelocation.png" alt="20 sept. 2017 @Paris" class="header-img upright">
              <!--<img src="./img/logo-apereo.png" alt="Apereo" class="header-img upright" style="max-height: 50px; padding-top: 15px;">-->
              <img src="./img/event-title.png" alt="ESUP-Days #24" class="event-title">
            </h1>
          </header>
          <div class="presentation-title">
            <div class="line-divider"></div>
            <h2>Retour sur l'usage de Horde 5<br> à l'Université Paris 1</h2>
            <ul class="presenters">
              <li>Pascal Rigaux</li>
              <li>Benoît Branciard</li>
            </ul>
            <ul class="institutions">
              <li>Université Paris 1 Panthéon-Sorbonne</li>
              <li>Université Paris 1 Panthéon-Sorbonne</li>
            </ul>
          </div>
        </section>

        <!--///////////////////////////////////////////-->
        <section>
                <header>
                  <h2 class="shadow">Plan</h2>
                </header>
                <div class="slide-content">
                <ul>
                    <li>Présentation de Horde</li>
                    <li>Infrastructure</li>
                    <li>Agenda</li>
                    <li>Webmail</li>
                    <li>Intégration CAS</li>
                    <li>Serveur IMAP</li>
		    <li>Comptes de fonction</li>
                    <li>Perspectives</li>
                </ul>
                </div>
                <footer>
                  <img src="./img/communaute.png" alt="">
                </footer>
              </section>
              
        <!--///////////////////////////////////////////-->
        <section>
                <header>
                  <h2 class="shadow">Présentation de Horde</h2>
                </header>
                <div class="slide-content">
                <ul>
                  <li>Collection d'outils :
                      <ul>
                        <li>Webmail, carnet d'adresses, gestion des filtres &amp; mgs d'absence</li>
                        <li>Agenda, tâches, fichiers, ...</li>
                    </ul>
                  <li>
                  Historique :<br>
                  <ul>
                    <li> 2002 : Horde 2</li>
                    <li> 2004 : Horde 3 <a href="https://lists.horde.org/archives/announce/2004/000140.html">(multi-charset / utf8, Sieve, IMAP quotas)</a></li>
           <!--         <li> 2008 : <a href="https://lists.horde.org/archives/announce/2008/000411.html">Horde 3.2</a></li> -->
                    <li> 2011 : Horde 4 <a href="https://lists.horde.org/archives/announce/2011/000607.html">(Web 2.0, vue mobile, ActiveSync)</a></li>
                    <li> 2012 : Horde 5 <a href="https://lists.horde.org/archives/announce/2012/000817.html">(nouvelles interfaces)</a></li>
                    <li> 2018? : Horde 6 <a href="https://www.horde.org/apps/webmail/roadmap">(roadmap)</a></li>
                  </ul></li>
                  <li>Projet actif : ~20 commits par semaine, 2 développeurs</li>                
                </ul>
                <br>&#9888; Documentation officielle peu à jour
            </div>
                <footer>
                  <img src="./img/communaute.png" alt="">
                </footer>
              </section>
      

        <!--///////////////////////////////////////////-->
        <section>
          <header>
            <h2>Présentation de Horde</h2>
            <h3 class="shadow">à Paris 1</h3>
          </header>
          <div class="slide-content">

            <style>
li.no-bullet {
  list-style: none !important;
}

table.with-border { border-collapse: collapse; width: 100%; }
table.with-border th { text-align: center; padding-bottom: 0.2em; min-width: 3em; }
table.with-border td { border: 1px solid; border-bottom-color: #ccc; padding: 0.4em !important; }
table.with-border tr td:first-child { border-left: none; border-top: none; border-bottom: none; vertical-align: middle; text-align: right; padding-right: 0.7em !important; }
table.with-border tr:last-child td { border-bottom-color: #000; }
table.with-border td.light-border-right { border-right-color: #ccc; border-right-style: dashed; }
table.with-border td.light-border-left { border-left-color: #ccc; border-left-style: dashed; }

table.title-on-left {
  width: 100%;
}
table.title-on-left th {
  text-align: center;
  vertical-align: bottom;
  font-size: 90%;
}
table.title-on-left td {
  text-align: center;
}
</style>
<ul>
  <li>2001-2002 : Horde 1</li>
  <li>2004 : Horde 2 pour les étudiants</li>
  <li>2005 : Horde 3 pour le personnel + Thunderbird avec autoconfig</li>
  <li>2016 : Horde 5 en test dans différents services</li>
  <li>2017 : Horde 5 pour le personnel (avec migration des carnets d'adresses, filtres)</li>
  <li>Statistiques :
<table class="title-on-left with-border">
              <tr>
                <th></th><th>utilisateurs par jour </th><th>utilisateurs par mois</th>
              </tr>
              <tr><td>webmail étudiant</td><td>~4000</td><td>~14000</td></tr>
              <tr><td>webmail personnel</td><td>~800</td><td>~2000</td></tr>
              <tr><td>web agenda</td><td>~180</td><td>~300</td></tr>
</table>
</ul>
          </div>
          <footer>
            <img src="./img/communaute.png" alt="">
          </footer>
        </section>
            
        <!--///////////////////////////////////////////-->
        <section>
          <header>
            <h2>Infrastructure</h2>
            <h3 class="shadow">à Paris 1</h3>
          </header>
          <div class="slide-content">
<table class="title-on-left with-border">
              <tr>
                <th></th><th>pour le personnel</th><th>pour les étudiants</th>
              </tr>
              <tr><td>Horde</td><td>2 CPU <br> 2 Go RAM<br><small>(dispo 4 CPU + 5 Go)</small></td><td>0,2 CPU<br>0,4 Go RAM</td></tr>
              <tr><td>Dovecot</td>
                      <td>2 CPU <br> 9 Go RAM<br>5 To stockage<br><small>(dispo 8 CPU + 15 Go)</small></td>
                      <td>1 CPU <br> 2 Go RAM<br>3,5 To stockage</td></tr>
</table>
<small>NB : la charge Horde personnel vient en partie des calendriers, cf page suivante</small>
<!--
            Pour le personnel
            <ul>
<li> Horde 5 : utilise 2 CPU + 2 Go RAM (dispo 4 CPU + 5 Go)
<li> Dovecot : utilise 1 CPU + 9 Go RAM (dispo 8 CPU + 15 Go) + espace disque utilisé ?
            </ul>
            <p>
            <br>
  Pour les étudiants
<br>
              <ul>
<li> Dovecot : utilise 1 CPU + 2 Go RAM + espace disque utilisé ?
<li> Horde 2 & 3 : 0,3 CPU
              </ul>
-->
          </div>
          <footer>
            <img src="./img/communaute.png" alt="">
          </footer>
        </section>


        <!--///////////////////////////////////////////-->
        <section>
          <header>
            <h2>Agenda</h2>
            <h3 class="shadow">pour le personnel</h3>
          </header>
          <div class="slide-content">
            Horde 5 permet les utilisations nomades :
            <ul>            
  <li> activesync pour les mobiles (mail + calendrier + contacts)
    <br>&#9888; consommation mémoire importante, non généralisable
  <li> caldav pour les mobiles et Thunderbird (Lightning)
      <ul>
        <li> kerberisé, comme notre imap <small>(apache mod-auth-kerb + SabreDAV auth avec REMOTE_USER)</small></li>
      </ul>
      &#9888; problèmes de performance, notamment avec Apple Calendar
      <small>(solution : limiter les calendriers accessibles à ceux activés dans le web agenda)</small></li>
  <li> web agenda
    <ul>
      <li>la nouvelle interface web introduit des régressions <small>(pauvreté des informations, création d'événements erronés, plus de catégorisation par couleurs...)</small></li>
      <li>la vue mobile est limitée : lecture seule, pas de choix d'agendas</li>
      <li>thème Paris1, intégration ProlongationENT
      </ul>
  </ul>
</li>
</ul>

          </div>
          <footer>
            <img src="./img/communaute.png" alt="">
          </footer>
        </section>

        <!--///////////////////////////////////////////-->
        <section>
          <header>
            <h2>Agenda</h2>
            <h3 class="shadow">faciliter la collaboration dans les services</h3>
          </header>
          <div class="slide-content">
            <img class="fragment" src="img/kronolith-agendas-services.gif" style="float: right; border: 2px solid #b5b5b5; border-right: 0px">
            <style>
              .allow-float {
              display: initial !important;
              }
            </style>
        <ul class="allow-float">
          <li>groupes institutionnels disponibles (via LDAP & grouper)</li>
          <li>calendriers partagés utilisés pour les salles de réunion</li>
          <li>au sein d'une direction :
            <ul>
            <li>calendriers partagés en lecture
            <li>nom du calendrier contient le nom du service,
              <br>permet de grouper les agendas par service
            </ul>
            synchronisation par cron du nom &amp; partage
          </ul>
        </ul>

          </div>
          <footer>
            <img src="./img/communaute.png" alt="">
          </footer>
        </section>
        

        <!--///////////////////////////////////////////-->
        <section>
                <header>
                      <h2 class="shadow">Agenda</h2>
                  </header>
                  <div class="slide-content">

              <div class="gallery-item">
                <a href="img/kronolith.png"><img src="img/kronolith.png"></a>
                <span>Kronolith avec ProlongationENT, thème Paris 1, agendas groupés</span>
              </div>                 
                  </div>
          <footer>
            <img src="./img/communaute.png" alt="">
          </footer>
        </section>
        
        <!--///////////////////////////////////////////-->
        <section>
          <header>
            <h2>Agenda</h2>
            <h3 class="shadow">invitations</h3>
          </header>
          <div class="slide-content">
            Par défaut le système d'invitations est prévu pour des serveurs d'agendas qui ne peuvent communiquer.
            Nous l'avons donc adapté :
            <ul>
<li>quand on accepte une invitation,
  <ul>
   <li>créer un événement dans l'agenda de l'utilisateur
   <li>page moins austère avec un lien « Voir l'événement dans votre agenda »
  </ul>
<li>dans le web agenda
    <ul>
      <li>afficher la liste des invitations non répondues
    </ul>    
<li>correctifs
      <ul>
        <li>éviter que l'acceptation d'une invitation dans Thunderbird conserve les participants
        <li>dans le web agenda, quand on fait « Enregistrer en tant que nouveau » sur un événement qui a des participants, question « supprimer les participants ou notifier les participants&nbsp; ? »
      </ul>
            </ul>
          </div>
          <footer>
            <img src="./img/communaute.png" alt="">
          </footer>
        </section>
  
        <!--///////////////////////////////////////////-->
        <section>
          <header>
            <h2 class="shadow">Webmail</h2>
          </header>
          <div class="slide-content">
            <ul>
	    <li>configuration
		<ul>
	            <li>beaucoup de possibilités, mais difficile de s'y retrouver.
		      <li>carnet d'adresses : recherche dans le personnel de l'université
                        <li>nommage des dossiers spéciaux uniformisé avec Thunderbird
                </ul>
	    <li>adaptations
 <ul>
            <li>thème Paris 1, intégration ProlongationENT</li>
	    <li>signature générée via l'application maison "signature.univ-paris1.fr"
      	    <li>menu déroulant proposant les différents comptes de fonction
              </ul>
</ul>
            <br>&#9888; interface web 2.0 difficile à utiliser pour certaines personnes
            <ul><li class="no-bullet"><ul><li>ascenseur virtuel pour naviguer dans les messages</li>
                <li>glisser/déplacer à la souris pour déplacer les messages</li>
            </ul> 
            </ul>
          </div>
          <footer>
            <img src="./img/communaute.png" alt="">
          </footer>
        </section>

        <!--///////////////////////////////////////////-->
        <section>
                <header>
                  <h2 class="shadow">Intégration CAS</h2>
                </header>
                <div class="slide-content">
                  <ul>
                    <li> casification simple via la méthode <a href="https://www.esup-portail.org/wiki/display/PROJHORDE/Installation+de+Horde-webmail">alternate login</a>
                      <li> avec <a href="https://www.esup-portail.org/wiki/x/swA8#id-01-Installationetparamétragedepam_cas-Cachedestickets">cache tickets</a> <a href="https://github.com/EsupPortail/esup-pam-cas">esup-pam-cas</a>
                        <small>(développé pour éviter un patch saslauthd)</small>
                    <li> et single logout CAS back-channel
                      <ul>
                        <li>Horde étant connu, des scripts d'automatisation sont utilisés par les pirates pour envoyer des spams après fishing,
                        <li>donc en cas de compte piraté, il faut annuler la session CAS &amp; Horde après avoir changé le mot de passe
                          <small>(pas d'invalidation du cache pam_cache puisque le proxy ticket est connu de Horde seul, il n'est pas connu du client web)</small>
                        <li>utilisation d'un outil pour annuler la session CAS d'un utilisateur
                      </ul>
                  </ul>
                  <p>
                     <small>Merci à Jérôme Nenert !</small>
                </div>
                <footer>
                  <img src="./img/communaute.png" alt="">
                </footer>
              </section>

        <!--///////////////////////////////////////////-->
        <section>
          <header>
            <h2>Serveur IMAP</h2>
            <h3 class="shadow">Dovecot</h3>
          </header>
          <div class="slide-content">
            <ul>
              <li>format de boîte <a href="https://wiki2.dovecot.org/MailboxFormat/dbox#Multi-dbox">MDBOX</a> avec "rotate size" de 20 Mo + purge glissante <small>(tous les 15 jours)</small>
         <li>quotas personnels de 5 Go et étudiants de 1 Go <small>(extensible à la demande justifiée)</small>
         <li>Sieve + manageSieve
           <li>backend LDAP <small>(userdb, règles de quota)</small> avec search sur uid, supannAliasLogin et mail
         <li>Authentification :
           <ul>
             <li>ticket Kerberos, PAM-CAS, mot de passe <small>(bind LDAP)</small>
               <li><a href="https://wiki2.dovecot.org/Authentication/MasterUsers">Master users</a> pour gérer les comptes de fonction
                 <ul>
                 <li>login "fonction*user" <small>(ou utilisation du "authorization ID" SASL)</small>
                 <li>autorisation par filtre sur attributs LDAP
                 </ul>
           </ul>
          </ul>
          </div>
          <footer>
            <img src="./img/communaute.png" alt="">
          </footer>
        </section>

        <!--///////////////////////////////////////////-->
        <section>
                <header>
                      <h2 class="shadow">Comptes de fonction</h2>
                  </header>
                <div class="slide-content">
                  <ul>
      <li>gérés dans Grouper :
        <ul>
          <li>1 boîte de fonction = 1 groupe 
          <li>rangés par domaine DNS
          <li>délégation de la gestion des membres via les privilèges Grouper,
		<br>mais peu utilisée pour l'instant (utilisation récente de Grouper)
        </ul>
      <li>publiés dans LDAP :           
        <br>cron qui ajoute les attributs de l'entrée LDAP pour en faire un compte mail <small>(posixAccount, mail, mailHost, etc)</small>
      </li>
      <li>Horde affiche un menu déroulant avec les comptes de fonction
        <ul>
          <li>compte de fonction passé en paramètre à l'alternate login cas_login.php</li>
        </ul>
      <li>autoconfig Thunderbird avec Active Directory
                  </ul>
                  
                </div>
                <footer>
                  <img src="./img/communaute.png" alt="">
                </footer>
              </section>

        <!--///////////////////////////////////////////-->
        <section>
                <header>
                      <h2 class="shadow">Comptes de fonction</h2>
                  </header>
                  <div class="slide-content">

              <div class="gallery-item">
                <a href="img/imp.gif"><img src="img/imp.gif"></a>
                <span>Menu déroulant avec les comptes de fonction</span>
              </div>                 
                  </div>
                <footer>
                  <img src="./img/communaute.png" alt="">
                </footer>
        </section>
              
        <!--///////////////////////////////////////////-->
        <section>
          <header>
            <h2 class="shadow">Perspectives</h2>
          </header>
          <div class="slide-content">
<ul>
  <li>2017-2018 : nombre de mails non lus dans l'accueil ENT (via <a href="https://github.com/prigaux/esup-imap-ws">Web Service CAS-IMAP</a>)
  <li>2018 : extension de Horde 5 aux étudiants 
  <li>2018-2019 : banalisation des serveurs de boîtes mail (étudiants+perso) + frontal IMAP proxy (Dovecot Director)
  <li> carnets d'adresses individuels centralisés kerbérisés partageables Horde + Thunderbird <small>(LDAP ? CardDAV fourni par Horde ?)</small>
  <li> optimisations serveurs de boîtes : process multi-users <small>(nécessite d'abandonner PAM-CAS au profit d'un développement de plugin dovecot-auth CAS)</small>
  <li> gestion des clés ou mots de passe "techniques" IMAP/SMTP par terminal ?
  <li>prochains événements de l'agenda dans l'accueil ENT
  </ul>
          </div>
          <footer>
            <img src="./img/communaute.png" alt="">
          </footer>
        </section>


        
      </div>
    </div>

    -->
    
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>

      Reveal.initialize({
        margin: 0,
        controls: true,
        progress: true,
        history: true,
        center: true,
        theme: 'simple', // available themes are in /css/theme
        transition: 'linear', // default/cube/page/concave/zoom/linear/fade/none
        dependencies: [ 
            // Cross-browser element.classList (esp needed on safari 4.0.5)
            { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },

            // Syntax highlight for <pre> elements
                  { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }

            ],
        });

        function createSingletonNode( container, tagname, classname, innerHTML ) {

          var node = container.querySelector( '.' + classname );
          if( !node ) {
              node = document.createElement( tagname );
              node.classList.add( classname );
              if( innerHTML !== null ) {
                  node.innerHTML = innerHTML;
              }
              container.appendChild( node );
          }
          return node;

        }

      // From https://github.com/hakimel/reveal.js/pull/56
      function slidenumber(event){
        var current_slide = 0;

        var horizontal_slides = document.querySelectorAll( '.reveal .slides>section' );
        for (var i = 0; i < event.indexh; i++) {
          // get subslides
          var subslides = horizontal_slides[i].querySelectorAll('section');

          // if subslides.length is 0, add 1 for horizontal slide, else add subslides.length
          current_slide += (subslides.length === 0) ? 1 : subslides.length;
        }

        current_slide += event.indexv+1;
        return current_slide.toString();
      }

      function setSlideNb(event) {
        var dom = createSingletonNode(document.querySelector(".controls"), "div", "slideNb");
        dom.innerHTML = event.indexh ? event.indexh : '';
      }

      Reveal.addEventListener('slidechanged', setSlideNb);
      Reveal.addEventListener('ready', setSlideNb);

    </script>

  </body>
</html>
